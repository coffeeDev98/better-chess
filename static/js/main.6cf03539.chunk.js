(this["webpackJsonpbetter-chess"]=this["webpackJsonpbetter-chess"]||[]).push([[0],{40:function(e,t,n){},41:function(e,t,n){},67:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(28),i=n.n(o),c=(n(40),n(41),n(2)),s=n(4),u=n(29),d=n.n(u),l=n(5),b=n(13),g="abcdefgh".split("");function p(e){return"[object Object]"===Object.prototype.toString.call(e)}function f(e){return"string"===typeof e}function v(e){if(!function(e){var t,n;return!1!==p(e)&&(void 0===(t=e.constructor)||!1!==p(n=t.prototype)&&!1!==n.hasOwnProperty("isPrototypeOf"))}(e))return!1;for(var t in e)if(e.hasOwnProperty(t)&&(!f(r=t)||-1===r.search(/^[a-h][1-8]$/)||(!f(n=e[t])||-1===n.search(/^[bw][KQRNBP]$/))))return!1;var n,r;return!0}function h(e){var t=e.split("");return"w"===t[0]?t[1].toUpperCase():t[1].toLowerCase()}var j,O,m,y,S,x,q,w=function(e){if(!v(e))return!1;for(var t="",n=8,r=0;r<8;r++){for(var a=0;a<8;a++){var o=g[a]+n;e.hasOwnProperty(o)?t+=h(e[o]):t+="1"}7!==r&&(t+="/"),n-=1}return t=function(e){return e.replace(/11111111/g,"8").replace(/1111111/g,"7").replace(/111111/g,"6").replace(/11111/g,"5").replace(/1111/g,"4").replace(/111/g,"3").replace(/11/g,"2")}(t)},M="BOARD_MOVE_UPDATE",k="BOARD_MOVE_UNDO",P=n(19),D=function(e){var t=e.pieceSquare,n=e.history,r=(n.length&&n[n.length-1].from,n.length&&n[n.length-1].to);return Object(c.a)(Object(l.a)({},t,{backgroundColor:"rgba(123,97,255,0.5)"}),n.length&&Object(l.a)({},r,{backgroundColor:"rgba(123,97,255,0.5)"}))},B=function(e,t){var n=Object(r.useState)(new P("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1")),a=Object(s.a)(n,1)[0],o=Object(r.useState)({fen:"start",dropSquareStyle:{},squareStyles:{},pieceSquare:"",square:"",history:[],boardPosition:{},pgn:[],undoMovesArray:[]}),i=Object(s.a)(o,2),u=i[0],d=i[1];Object(r.useEffect)((function(){console.log("UNDO MOVES: ",u.undoMovesArray)}),[u.undoMovesArray]),Object(r.useEffect)((function(){var n;e.channel&&(null===(n=e.channel)||void 0===n||n.on("ChannelMessage",(function(e){var n,r=(n=e.text,JSON.parse(n));switch(r.type){case M:p({sourceSquare:r.json.move.from,targetSquare:r.json.move.to});break;case k:var o={chess:a,state:u,setState:d,undoArray:r.json.undoArray};t.undoMove(o);break;default:console.log("INVALID OPERATION")}})))}),[e.channel]);var g=function(e,t,n){var r=e,o=t;a.move({from:r,to:o,promotion:n}),d(Object(c.a)(Object(c.a)({},u),{},{fen:a.fen()}))},p=function(e){for(var n=e.sourceSquare,r=e.targetSquare,o=(e.piece,a.move({from:n,to:r})),i=a.moves({verbose:!0}),s=0,l=i.length;s<l;s++)if(-1!==i[s].flags.indexOf("p")&&i[s].from===n)return void g(n,r,"r");null!==o&&(d((function(e){var t,n=e.history,r=e.pieceSquare;return Object(c.a)(Object(c.a)({},u),{},{fen:a.fen(),pgn:null===(t=a.pgn())||void 0===t?void 0:t.split(/\d\./),history:a.history({verbose:!0}),squareStyles:D({pieceSquare:r,history:n})})})),t.updateBoard(o))};return{setBoardPosition:function(e){console.log("BOARD POSITION: ",e),d(Object(c.a)(Object(c.a)({},u),{},{boardPosition:e}))},fen:u.fen,pgn:u.pgn,onDrop:p,onMouseOverSquare:function(e){var t=a.moves({square:e,verbose:!0});if(0!==t.length){for(var n=[],r=0;r<t.length;r++)n.push(t[r].to);!function(e,t){var n=[e].concat(Object(b.a)(t)).reduce((function(e,t){return Object(c.a)(Object(c.a)(Object(c.a)({},e),Object(l.a)({},t,{background:"radial-gradient(circle, rgb(123,97,255,0.5) 20%, transparent 0%)",borderRadius:"50%"})),D({history:u.history,pieceSquare:u.pieceSquare}))}),{});d((function(e){var t=e.squareStyles;return Object(c.a)(Object(c.a)({},u),{},{squareStyles:Object(c.a)(Object(c.a)({},t),n)})}))}(e,n)}},onMouseOutSquare:function(e){d((function(e){var t=e.pieceSquare,n=e.history;return Object(c.a)(Object(c.a)({},u),{},{squareStyles:D({pieceSquare:t,history:n})})}))},squareStyles:u.squareStyles,onDragOverSquare:function(e){d(Object(c.a)(Object(c.a)({},u),{},{dropSquareStyle:"e4"===e||"d4"===e||"e5"===e||"d5"===e?{backgroundColor:"cornFlowerBlue"}:{boxShadow:"inset 0 0 1px 4px rgb(255, 255, 0)"}}))},onSquareClick:function(e){var n;d((function(t){var n=t.history;return Object(c.a)(Object(c.a)({},u),{},{squareStyles:D({pieceSquare:e,history:n}),pieceSquare:e})}));for(var r=a.move({from:u.pieceSquare,to:e}),o=a.moves({verbose:!0}),i=0,s=o.length;i<s;i++)if(-1!==o[i].flags.indexOf("p")&&o[i].from===u.pieceSquare)return void g(u.pieceSquare,e,"r");null!==r&&(d(Object(c.a)(Object(c.a)({},u),{},{fen:a.fen(),pgn:null===(n=a.pgn())||void 0===n?void 0:n.split(/\d\./),history:a.history({verbose:!0}),pieceSquare:""})),t.updateBoard(r))},onSquareRightClick:function(e){return d(Object(c.a)(Object(c.a)({},u),{},{squareStyles:Object(l.a)({},e,{backgroundColor:"deepPink"})}))},undoMove:function(){var e=a.undo();e&&(d(Object(c.a)(Object(c.a)({},u),{},{fen:a.fen(),undoMovesArray:[].concat(Object(b.a)(u.undoMovesArray),[e])})),t.undoMoveMsg([].concat(Object(b.a)(u.undoMovesArray),[e])))},redoMove:function(){if(0!==u.undoMovesArray.length){var e=u.undoMovesArray.pop();if(console.log("REDO: ",e),e){var n=a.move(e);console.log("REDONE: ",n),null!==n&&(d((function(e){var t,n=e.history,r=e.pieceSquare;return Object(c.a)(Object(c.a)({},u),{},{fen:a.fen(),pgn:null===(t=a.pgn())||void 0===t?void 0:t.split(/\d\./),history:a.history({verbose:!0}),squareStyles:D({pieceSquare:r,history:n})})})),t.updateBoard(n))}}}}},C=n(16),E=n.n(C),A=n(30),N=n(31),R=n.n(N),W=n(32),I=n.n(W),L={messageParser:function(e){return{text:(t=e,JSON.stringify(t)),messageType:"TEXT"};var t}},F=function(){var e=Object(r.useState)(null),t=Object(s.a)(e,2),n=t[0],a=t[1],o=R.a.createInstance("f4b36b6c897e41bfaa3904d75da40777"),i={uid:(Math.floor(9e4*Math.random())+1e4).toString(),token:""};Object(r.useEffect)((function(){(function(){var e=Object(A.a)(E.a.mark((function e(){return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:I.a.get("https://agoratokenserver-demo.herokuapp.com/access_token?channel=test&uid=".concat(i.uid)).then((function(e){var t;console.log(e),i.token=(null===(t=e.data)||void 0===t?void 0:t.token)||"",o.login(i).then((function(){console.log("Login successful");var e=o.createChannel("test");e.join(),a(e)}))}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()().then((function(){console.log("integrations successful")}))}),[]),Object(r.useEffect)((function(){n&&(null===n||void 0===n||n.on("MemberJoined",(function(e){console.log("New member joined: ",e)})),null===n||void 0===n||n.on("MemberLeft",(function(e){console.log("Member left: ",e)})))}),[n]);return{channel:n,playerMeta:i,sendChannelMessage:function(e,t){var r={uid:i.uid,json:e||{},type:t};console.log(L.messageParser(r)),null===n||void 0===n||n.sendMessage(L.messageParser(r)).then((function(){}))}}},K=function(e){var t=e.Agora;return{updateBoard:function(e){var n={move:e};null===t||void 0===t||t.sendChannelMessage(n,M)},undoMoveMsg:function(e){var n={undoArray:e};null===t||void 0===t||t.sendChannelMessage(n,k)},undoMove:function(e){var t=e.chess,n=e.state,r=e.setState,a=e.undoArray;t.undo()&&r(Object(c.a)(Object(c.a)({},n),{},{fen:t.fen(),undoMovesArray:a}))}}},Q=n(19),T="8/8/8/8/8/8/8/8",J=function(){var e=Object(r.useState)(new Q(T)),t=(Object(s.a)(e,1)[0],Object(r.useState)({fen:T,dropSquareStyle:{},squareStyles:{},pieceSquare:"",square:"",history:[],boardPosition:{},pgn:[]})),n=Object(s.a)(t,2),a=n[0],o=n[1];Object(r.useEffect)((function(){console.log("FEN: ",a.fen)}),[a.fen]);return{fen:a.fen,pgn:a.pgn,onDrop:function(e){var t=e.sourceSquare,n=e.targetSquare,r=e.piece;if("spare"===t){var i=Object(c.a)(Object(c.a)({},a.boardPosition),{},Object(l.a)({},n,r));o(Object(c.a)(Object(c.a)({},a),{},{fen:w(i)||a.fen,boardPosition:i}))}}}},U=n(6),_=n(7),V=Object(_.a)(j||(j=Object(U.a)(["\n  background-color: #2b2b34;\n  width: 370px;\n  border-radius: 0px 16px 16px 0px;\n"]))),$=_.b.div(O||(O=Object(U.a)(["\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n  ","\n"])),(function(e){return e.editorMode&&V})),z=_.b.div(m||(m=Object(U.a)(["\n  div {\n    padding: 14px;\n    cursor: pointer;\n  }\n"]))),G=_.b.div(y||(y=Object(U.a)(["\n  div {\n      padding: 14px;\n      cursor: pointer;\n    }\n"]))),H=Object(_.a)(S||(S=Object(U.a)(['\n  div[class$="-spare-pieces"] {\n    position: absolute;\n    width: 270px;\n    display: flex;\n    justify-content: space-between;\n    div[data-testid^="spare-"]:nth-child(odd) {\n      background: #b7c0d8;\n    }\n    div[data-testid^="spare-"]:nth-child(even) {\n      background: #e8edf9;\n    }\n    div {\n      width: 100%;\n      margin: 2px;\n      border-radius: 12px;\n      div {\n        img {\n          padding: 10px 12px;\n          width: 26px !important;\n          height: 28px !important;\n        }\n      }\n    }\n  }\n']))),X=_.b.div(x||(x=Object(U.a)(['\n  display: flex;\n  /* width: 1000px; */\n  /* height: fit-content; */\n  max-width: 1440px;\n  background: black;\n  grid-template-columns: 66% 37%;\n  grid-template-areas: "board sidePanel";\n  .board-container {\n    position:relative;\n    min-width: 500px;\n    min-height: 500px;\n    grid-area: board;\n    border: 10px solid rgba(255, 255, 255);\n    div {\n      ',"\n      .black-spare-pieces {\n        left: ",";\n\n        /* background:grey; */\n      }\n      .white-spare-pieces {\n        left: ",";\n        bottom: ",";\n        /* background:grey; */\n      }\n    }  \n  }\n  \n  "," {\n    grid-area: sidePanel;\n    /* width: 100%; */\n    /* height: 100%; */\n  ",", "," {\n    background: #2b2b34;\n    border: 2px solid rgba(255, 255, 255, 0.1);\n    border-radius: 0 8px 8px 0;\n  }\n}\n"])),(function(e){return e.editorMode&&H}),(function(e){return e.dimension?"".concat(e.dimension+20,"px"):"0px"}),(function(e){return e.dimension?"".concat(e.dimension+20,"px"):"0px"}),(function(e){return e.dimension?"".concat(e.dimension-120,"px"):"0px"}),$,z,G),Y=(_.b.div(q||(q=Object(U.a)(["\n  color: white;\n"]))),n.p+"static/media/undoMove.586eb02f.svg"),Z=n.p+"static/media/redoMove.c6f42448.svg",ee=n.p+"static/media/history.8223d0ff.svg",te=n.p+"static/media/resetBoard.7af0fcde.svg",ne=n.p+"static/media/flipBoard.c1ef8478.svg",re=n.p+"static/media/loadGame.28f8774a.svg",ae=n.p+"static/media/wK.3b342df8.svg",oe=n.p+"static/media/wQ.785db365.svg",ie=n.p+"static/media/wB.56f72474.svg",ce=n.p+"static/media/wR.33cf0258.svg",se=n.p+"static/media/wN.d5fa39eb.svg",ue=n.p+"static/media/wP.5f74a9fe.svg",de=n.p+"static/media/bK.e57316c7.svg",le=n.p+"static/media/bQ.c21470b8.svg",be=n.p+"static/media/bB.1f023e3e.svg",ge=n.p+"static/media/bR.2724e583.svg",pe=n.p+"static/media/bN.a46c4723.svg",fe=n.p+"static/media/bP.d9262a65.svg",ve=n(1),he=function(e){var t=e.undoMove,n=e.redoMove;return Object(ve.jsxs)(ve.Fragment,{children:[Object(ve.jsxs)(z,{children:[Object(ve.jsx)("div",{onClick:t,children:Object(ve.jsx)("img",{src:Y,alt:"Undo"})}),Object(ve.jsx)("div",{onClick:n,children:Object(ve.jsx)("img",{src:Z,alt:"Redo"})}),Object(ve.jsx)("div",{children:Object(ve.jsx)("img",{src:ee,alt:"History"})}),Object(ve.jsx)("div",{children:Object(ve.jsx)("img",{src:te,alt:"Reset"})}),Object(ve.jsx)("div",{children:Object(ve.jsx)("img",{src:ne,alt:"Flip"})})]}),Object(ve.jsx)(G,{children:Object(ve.jsx)("div",{children:Object(ve.jsx)("img",{src:re,alt:"Load"})})})]})},je=function(e){var t=Object(r.useState)(),n=Object(s.a)(t,2),a=n[0],o=n[1],i=Object(r.useState)(!1),u=Object(s.a)(i,2),l=u[0],b=(u[1],Object(r.useState)("menu")),g=Object(s.a)(b,2),p=g[0],f=(g[1],F()),v=K({Agora:f}),h=J(),j=B(f,v),O=j.setBoardPosition,m=j.fen,y=(j.pgn,j.onDrop),S=j.onMouseOverSquare,x=j.onMouseOutSquare,q=j.squareStyles,w=j.onDragOverSquare,M=j.onSquareClick,k=j.onSquareRightClick,P=j.undoMove,D=j.redoMove;Object(r.useEffect)((function(){return C(),window.addEventListener("resize",C),function(){return window.removeEventListener("resize",C)}}),[]),Object(r.useEffect)((function(){var e,t=null===(e=window.document.getElementById("board-container"))||void 0===e?void 0:e.querySelector("div"),n=null===t||void 0===t?void 0:t.firstElementChild,r=null===t||void 0===t?void 0:t.lastElementChild;n&&r&&(n.classList.add("black-spare-pieces"),r.classList.add("white-spare-pieces"),n.setAttribute("style",""),r.setAttribute("style",""))}),[window.document.getElementById("board-container")]);var C=function(){var e;o(null===(e=window.document.getElementById("board-container"))||void 0===e?void 0:e.clientWidth)},E={wK:function(e){var t=e.squareWidth;e.isDragging;return Object(ve.jsx)("img",{style:{width:t,height:t},src:ae,alt:"wK"})},wQ:function(e){var t=e.squareWidth;e.isDragging;return Object(ve.jsx)("img",{style:{width:t,height:t},src:oe,alt:"wQ"})},wB:function(e){var t=e.squareWidth;e.isDragging;return Object(ve.jsx)("img",{style:{width:t,height:t},src:ie,alt:"wB"})},wR:function(e){var t=e.squareWidth;e.isDragging;return Object(ve.jsx)("img",{style:{width:t,height:t},src:ce,alt:"wR"})},wN:function(e){var t=e.squareWidth;e.isDragging;return Object(ve.jsx)("img",{style:{width:t,height:t},src:se,alt:"wN"})},wP:function(e){var t=e.squareWidth;e.isDragging;return Object(ve.jsx)("img",{style:{width:t,height:t},src:ue,alt:"wP"})},bK:function(e){var t=e.squareWidth;e.isDragging;return Object(ve.jsx)("img",{style:{width:t,height:t},src:de,alt:"bK"})},bQ:function(e){var t=e.squareWidth;e.isDragging;return Object(ve.jsx)("img",{style:{width:t,height:t},src:le,alt:"bQ"})},bB:function(e){var t=e.squareWidth;e.isDragging;return Object(ve.jsx)("img",{style:{width:t,height:t},src:be,alt:"bB"})},bR:function(e){var t=e.squareWidth;e.isDragging;return Object(ve.jsx)("img",{style:{width:t,height:t},src:ge,alt:"bR"})},bN:function(e){var t=e.squareWidth;e.isDragging;return Object(ve.jsx)("img",{style:{width:t,height:t},src:pe,alt:"bN"})},bP:function(e){var t=e.squareWidth;e.isDragging;return Object(ve.jsx)("img",{style:{width:t,height:t},src:fe,alt:"bP"})}},A=Object(c.a)(Object(c.a)(Object(c.a)({id:"board-0",position:l?h.fen:m,draggable:!0,lightSquareStyle:{backgroundColor:"#E8EDF9"},darkSquareStyle:{backgroundColor:"#B7C0D8"},pieces:E,boardStyle:{width:a,height:a,position:"relative"},width:a},l?{onDrop:h.onDrop}:{onDrop:y}),!l&&{getPosition:O,onMouseOverSquare:S,onMouseOutSquare:x,squareStyles:q,onDragOverSquare:w,onSquareClick:M,onSquareRightClick:k}),{},{sparePieces:l});return Object(ve.jsxs)(X,{dimension:a,editorMode:l,children:[Object(ve.jsx)("div",{id:"board-container",className:"board-container",children:Object(ve.jsx)(d.a,Object(c.a)({},A))}),Object(ve.jsx)($,{editorMode:l,children:!l&&Object(ve.jsx)(ve.Fragment,{children:"menu"===p&&Object(ve.jsx)(he,{undoMove:P,redoMove:D})})})]})};var Oe=function(){return Object(ve.jsx)("div",{className:"app",children:Object(ve.jsx)(je,{})})},me=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,68)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,o=t.getLCP,i=t.getTTFB;n(e),r(e),a(e),o(e),i(e)}))};i.a.render(Object(ve.jsx)(a.a.StrictMode,{children:Object(ve.jsx)(Oe,{})}),document.getElementById("root")),me()}},[[67,1,2]]]);
//# sourceMappingURL=main.6cf03539.chunk.js.map